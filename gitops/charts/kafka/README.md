# Helm-чарт для Strimzi Kafka Operator

## Обзор

Этот Helm-чарт предназначен для установки и декларативного управления Kafka в Kubernetes с использованием [Strimzi Kafka Operator](https://strimzi.io/).

Чарт спроектирован для работы в рамках GitOps-подхода с использованием ArgoCD и является **полностью самодостаточным**. Он включает в себя все необходимые манифесты для развертывания:

- **Strimzi Kafka Operator**: Устанавливается из манифестов, включенных в чарт.
- **Kafka Cluster (KRaft-mode)**: Создается кастомный ресурс `Kafka`, который дает команду оператору развернуть сам Kafka-кластер в без-Zookeeper режиме (KRaft).
- **Kafka Topics**: Создаются кастомные ресурсы `KafkaTopic` для декларативного управления топиками.

## Архитектура

- `crds/`: Содержит Custom Resource Definitions (CRD) для всех ресурсов Strimzi.
- `templates/operator.yaml`: Содержит все ресурсы для развертывания самого **оператора** (Deployment, Roles, ServiceAccounts и т.д.).
- `templates/kafka-cluster.yaml`: Создает кастомный ресурс `Kafka` для развертывания кластера.
- `templates/kafka-topics.yaml`: Создает ресурсы `KafkaTopic` на основе списка в `values.yaml`.
- `values.yaml`: Файл для конфигурации всех вышеперечисленных компонентов.

## Конфигурация

Все основные параметры настраиваются в файле `values.yaml`.

| Параметр | Описание |
|---|---|
| `image.tag` | Глобальный тег, используемый для образа оператора Strimzi. |
| `kafka.version` | Версия Kafka, которая будет развернута. |
| `kafka.replicas` | Количество реплик (подов) Kafka. Для KRaft рекомендуется 1 или 3. |
| `kafka.storage.type`| Тип хранилища. Для KRaft с одной репликой должен быть `jbod`. |
| `kafka.storage.size` | Размер диска для хранения данных. |
| `topics` | Список топиков для автоматического создания. |

## GitOps-процесс

1.  ArgoCD настраивается на отслеживание директории `helm/kafka` в Git-репозитории.
2.  Для изменения конфигурации (например, добавления нового топика) вы редактируете секцию `topics` в файле `values.yaml`.
3.  Вы коммитите и отправляете изменения в Git.
4.  ArgoCD обнаруживает изменения и применяет обновленный ресурс `KafkaTopic` в кластер.
5.  Strimzi Operator обнаруживает новый ресурс и создает топик в работающем кластере Kafka.
