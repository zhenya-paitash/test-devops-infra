# Ansible для управления инфраструктурой

Эта директория содержит все необходимое для настройки и управления нашими серверами с помощью Ansible.

## Структура

- `ansible.cfg`: Основной конфигурационный файл.
- `requirements.yml`: Список внешних коллекций Ansible, необходимых для работы.
- `inventories/`: Директория с файлами инвентаря для разных окружений (`dev`, `prod`).
- `playbooks/`: Плейбуки, которые описывают, какие роли и на каких хостах выполнять.
- `roles/`: Переиспользуемые роли для выполнения конкретных задач.

## Первоначальная настройка

Перед первым запуском необходимо установить коллекции, перечисленные в `requirements.yml`. Это делается одной командой:

```bash
ansible-galaxy collection install -r requirements.yml
```

## Как запускать плейбуки

**Важно:** Все команды `ansible-playbook` следует запускать из этой директории (`infrastructure/ansible/`).

### Основной принцип

Мы больше не прописываем конкретный файл инвентаря в `ansible.cfg`. Вместо этого мы указываем директорию `inventories`. Это позволяет нам легко выбирать нужное окружение при запуске с помощью флага `-i`.

### Пример: Запуск плейбука для DEV окружения

Чтобы запустить плейбук `install_kubernetes.yml` на хостах из `dev`-окружения, используйте следующую команду:

```bash
ansible-playbook -i inventories/dev playbooks/install_kubernetes.yml
```

- `-i inventories/dev`: Указывает Ansible использовать все файлы инвентаря из директории `dev`.

### Пример: Запуск для PROD окружения

Аналогично, для `prod` окружения (когда вы его создадите):

```bash
ansible-playbook -i inventories/prod playbooks/install_kubernetes.yml
```

Этот подход позволяет гибко управлять конфигурациями для разных стендов, не меняя основной код и не создавая сложных команд.